{% extends "base.html" %}
{% block content %}

<div class="container-fluid p-0" style="min-height:120vh; background: linear-gradient(to bottom, #f0f4ff, #ffe6f0);">

  <!-- ‚úÖ WELCOME SECTION -->
  <div class="text-center px-3 mb-5 animate-fadein" style="animation-delay:0.2s;">
    <h4 class="fw-bold rainbow-text">Welcome, {{ user.username }}!</h4>
    <p class="text-muted small">Manage your pets easily</p>
  </div>

  <!-- ‚úÖ ADD PET CARD -->
  <div class="mx-auto mb-5 p-4 shadow-lg animate-fadein"
       style="max-width:400px; background:#dbe9ff; border-radius:20px; animation-delay:0.4s;">
    
    <div class="text-center pt-4">
      <img src="{{ url_for('static', filename='images/alls.jpg') }}"
           width="120" class="rounded-circle shadow mb-3 animate-fadein">
    </div>

    <h5 class="text-center fw-bold mb-4 rainbow-text">Add a New Pet</h5>

    <form action="{{ url_for('add_pet') }}" method="POST" class="row g-3">

      <div class="col-12">
        <input type="text" name="name" placeholder="Pet Name"
               class="form-control rounded-pill text-center shadow-sm" required>
      </div>

      <div class="col-12">
        <input type="text" name="species" placeholder="Species"
               class="form-control rounded-pill text-center shadow-sm" required>
      </div>

      <div class="col-12">
        <input type="text" name="breed" placeholder="Breed"
               class="form-control rounded-pill text-center shadow-sm" required>
      </div>

      <div class="col-12">
        <input type="number" name="age" placeholder="Age"
               class="form-control rounded-pill text-center shadow-sm" required>
      </div>

      <div class="col-12">
        <button class="btn w-100 rounded-pill fw-bold shadow-sm glowing-btn animate-bounce">
          Add Pet
        </button>
      </div>
    </form>
  </div>

  <!-- ‚úÖ YOUR PETS TITLE -->
  <h5 class="text-center mt-4 fw-bold mb-3 rainbow-text animate-fadein" style="animation-delay:0.6s;">
    ‚ù§ Your Beloved Pets ‚ù§
  </h5>

  <!-- ‚úÖ PET LIST -->
  <div class="row px-3">
    {% for pet in user.pets %}
      <div class="col-md-4 col-sm-6 col-12 mb-4 animate-fadein pet-wrapper">
        <div class="p-3 shadow-sm text-center pet-card rainbow-shadow">

          <a href="{{ url_for('pet_profile', pet_id=pet.id) }}" style="text-decoration:none;">
            <div class="pet-circle mx-auto {% if not pet.photo %}rainbow-pulse{% endif %}">
              {% if pet.photo %}
                <img src="{{ url_for('static', filename='uploads/' + pet.photo) }}" class="pet-img">
              {% else %}
                <span class="pet-letter">{{ pet.name[0]|upper }}</span>
              {% endif %}
            </div>
          </a>

          <h6 class="mt-3 fw-bold rainbow-text animate-text">{{ pet.name }}</h6>

          <div class="d-flex justify-content-between align-items-center mt-3 px-2">

            <a href="{{ url_for('pet_profile', pet_id=pet.id) }}"
               class="btn btn-sm rounded-pill glowing-btn animate-bounce-slow">
              View Profile
            </a>

            <!-- ‚úÖ DELETE BUTTON -->
            <button class="btn btn-sm rounded-pill delete-btn"
                    onclick="confirmDelete({{ pet.id }}, this)">
              Delete Pet
            </button>

          </div>
        </div>
      </div>

    {% else %}
      <p class="text-center fw-bold mt-3" style="color:#0b2c5d;">
        No pets added yet. Add your first pet above!
      </p>
    {% endfor %}
  </div>
</div>

<!-- ‚úÖ DELETE CONFIRMATION MODAL -->
<div id="deleteModal" class="delete-modal">
  <div class="delete-box animate-zoom">
    <h5>üêæ Pet Account Deletion</h5>
    <p>Do you really want to delete this pet‚Äôs account?</p>
    <div class="d-flex justify-content-between mt-3">
      <button class="btn btn-danger rounded-pill px-4" onclick="deletePetConfirmed()">Delete</button>
      <button class="btn btn-secondary rounded-pill px-4" onclick="closeDeleteModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- ‚úÖ SCRIPT (NO PAGE RELOAD DELETE) -->
<script>
let deletePetId = null;
let deleteBtnRef = null;

function confirmDelete(petId, btn) {
  deletePetId = petId;
  deleteBtnRef = btn;
  document.getElementById("deleteModal").style.display = "flex";
}

function closeDeleteModal() {
  deletePetId = null;
  deleteBtnRef = null;
  document.getElementById("deleteModal").style.display = "none";
}

function deletePetConfirmed() {
  fetch(`/delete_pet/${deletePetId}`, {
    method: "POST"
  })
  .then(res => {
    if (res.ok) {
      deleteBtnRef.closest(".pet-wrapper").remove(); // ‚úÖ remove UI
      closeDeleteModal();
    } else {
      alert("Delete failed!");
    }
  })
  .catch(() => alert("Server error!"));
}
</script>

<!-- ‚úÖ COMPLETE FIXED CSS -->
<style>

@keyframes fadeInUp {
  0% { opacity:0; transform: translateY(20px); }
  100% { opacity:1; transform: translateY(0); }
}
.animate-fadein { animation: fadeInUp 0.6s forwards; opacity:0; }

.pet-card {
  background: #ffffff;
  border-radius: 20px;
  transition: transform 0.3s;
}
.pet-card:hover { transform: translateY(-10px) scale(1.05); }

.pet-circle {
  width: 120px; height: 120px;
  border-radius: 50%;
  background: #dbe9ff;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px dashed #0b2c5d;
  overflow: hidden;
}

/* ‚úÖ FINAL CIRCLE IMAGE FIX */
.pet-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
}

.pet-letter {
  font-size: 40px;
  font-weight: bold;
  color: #0b2c5d;
}

.rainbow-pulse {
  animation: rainbowPulse 2s infinite;
}

@keyframes rainbowPulse {
  0% { box-shadow: 0 0 10px red; }
  25% { box-shadow: 0 0 10px orange; }
  50% { box-shadow: 0 0 10px yellow; }
  75% { box-shadow: 0 0 10px green; }
  100% { box-shadow: 0 0 10px red; }
}

.glowing-btn {
  background: linear-gradient(45deg, #ff5f6d, #ffc371, #47d1ff, #a4508b);
  background-size: 400% 400%;
  color: white;
  border: none;
  animation: gradientBG 8s ease infinite;
}

@keyframes gradientBG {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}

.delete-btn {
  background: linear-gradient(45deg, #ff0000, #ff6b6b);
  color: white;
  border: none;
  transition: 0.3s ease;
}
.delete-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 0 10px red;
}

/* ‚úÖ MODAL */
.delete-modal {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.delete-box {
  background: white;
  padding: 25px;
  width: 90%;
  max-width: 350px;
  text-align: center;
  border-radius: 20px;
}

@keyframes zoomIn {
  from { transform: scale(0.7); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
.animate-zoom { animation: zoomIn 0.3s ease; }

</style>

{% endblock %}
